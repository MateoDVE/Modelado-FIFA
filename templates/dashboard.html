<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Predicci√≥n de Futbolistas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .slider-container {
            margin-bottom: 15px;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }
        #result-section {
            display: none;
        }
        .prediction-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #0d6efd;
        }
        .growth-value {
            font-size: 1.2rem;
            color: #198754;
        }
        .growth-negative {
            color: #dc3545;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center mb-4">Simulador de Futbolistas con IA</h1>
    
    <div class="row">
        <!-- Input Section -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    Par√°metros del Jugador
                </div>
                <div class="card-body">
                    <form id="prediction-form">
                        <div class="slider-container">
                            <div class="slider-label">
                                <label for="fisico">F√≠sico</label>
                                <span id="val-fisico">50</span>
                            </div>
                            <input type="range" class="form-range" id="fisico" min="0" max="100" value="50">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <label for="tecnica">Talento (T√©cnica)</label>
                                <span id="val-tecnica">50</span>
                            </div>
                            <input type="range" class="form-range" id="tecnica" min="0" max="100" value="50">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <label for="mentalidad">Mentalidad</label>
                                <span id="val-mentalidad">50</span>
                            </div>
                            <input type="range" class="form-range" id="mentalidad" min="0" max="100" value="50">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <label for="rating">Rating Actual</label>
                                <span id="val-rating">50</span>
                            </div>
                            <input type="range" class="form-range" id="rating" min="0" max="100" value="50">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <label for="edad">Edad</label>
                                <span id="val-edad">25</span>
                            </div>
                            <input type="range" class="form-range" id="edad" min="15" max="45" value="25">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <label for="lesiones" class="text-danger">Riesgo Lesiones</label>
                                <span id="val-lesiones">0</span>
                            </div>
                            <input type="range" class="form-range" id="lesiones" min="0" max="100" value="0">
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">Simular Predicci√≥n</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="col-md-8">
            <div id="result-section">
                <div class="row">
                    <!-- Potential Prediction -->
                    <div class="col-md-6">
                        <div class="card text-center h-100">
                            <div class="card-header bg-info text-white">
                                Potencial Estimado (Red 1)
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center">
                                <div class="prediction-value" id="pred-potential">--</div>
                                <div class="growth-value" id="pred-growth">Crecimiento: --</div>
                                <p class="mt-3 text-muted">Basado en atributos f√≠sicos, t√©cnicos y mentales.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Position Prediction -->
                    <div class="col-md-6">
                        <div class="card text-center h-100">
                            <div class="card-header bg-warning text-dark">
                                Posici√≥n Ideal (Red 2)
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center">
                                <div class="prediction-value" id="pred-position">--</div>
                                <p class="mt-3 text-muted">Posici√≥n recomendada seg√∫n perfil.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Probabilities Chart -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                Probabilidades por Posici√≥n
                            </div>
                            <div class="card-body">
                                <canvas id="probsChart" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Simulation Chart -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-dark text-white">
                                Evoluci√≥n del Rendimiento (10 a√±os)
                            </div>
                            <div class="card-body">
                                <canvas id="simChart" height="150"></canvas>
                                <p class="text-muted small mt-2">
                                    * La l√≠nea roja indica el Rating General (R). Las otras l√≠neas muestran la evoluci√≥n de F√≠sico, T√©cnica y Mentalidad.
                                    Si se activaron lesiones, se observar√°n ca√≠das en el rendimiento f√≠sico.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Placeholder when no results -->
            <div id="placeholder-section" class="text-center p-5 text-muted">
                <h3>üëà Ajusta los par√°metros y pulsa "Simular"</h3>
                <p>Los modelos de IA analizar√°n el perfil del jugador.</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Update slider values
    const inputs = ['fisico', 'tecnica', 'mentalidad', 'rating', 'edad', 'lesiones'];
    inputs.forEach(id => {
        const slider = document.getElementById(id);
        const label = document.getElementById(`val-${id}`);
        slider.addEventListener('input', () => {
            label.textContent = slider.value;
        });
    });

    // Chart instances
    let myChart = null;
    let simChart = null;

    // Handle form submission
    document.getElementById('prediction-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const data = {
            Fisico: document.getElementById('fisico').value,
            Tecnica: document.getElementById('tecnica').value,
            Mentalidad: document.getElementById('mentalidad').value,
            Ratting: document.getElementById('rating').value,
            Edad: document.getElementById('edad').value,
            Lesiones: document.getElementById('lesiones').value
        };

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            // Show results
            document.getElementById('result-section').style.display = 'block';
            document.getElementById('placeholder-section').style.display = 'none';
            
            // Update Potential
            if (result.potential) {
                document.getElementById('pred-potential').textContent = result.potential.toFixed(1);
                const growth = result.growth;
                const growthEl = document.getElementById('pred-growth');
                growthEl.textContent = `Crecimiento: ${growth >= 0 ? '+' : ''}${growth.toFixed(1)}`;
                growthEl.className = growth >= 0 ? 'growth-value' : 'growth-value growth-negative';
            }
            
            // Update Position
            if (result.position) {
                document.getElementById('pred-position').textContent = result.position;
            }
            
            // Update Probs Chart
            if (result.position_probs) {
                const ctx = document.getElementById('probsChart').getContext('2d');
                const labels = Object.keys(result.position_probs);
                const values = Object.values(result.position_probs).map(v => v * 100); // percentage
                
                if (myChart) {
                    myChart.destroy();
                }
                
                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Probabilidad (%)',
                            data: values,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            // Update Simulation Chart
            if (result.simulation) {
                const ctxSim = document.getElementById('simChart').getContext('2d');
                const simData = result.simulation;
                
                if (simChart) {
                    simChart.destroy();
                }
                
                simChart = new Chart(ctxSim, {
                    type: 'line',
                    data: {
                        labels: simData.age, // X-axis: Age
                        datasets: [
                            {
                                label: 'Rating General (R)',
                                data: simData.R,
                                borderColor: 'rgba(220, 53, 69, 1)', // Red
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'F√≠sico (F)',
                                data: simData.F,
                                borderColor: 'rgba(25, 135, 84, 0.6)', // Green
                                borderDash: [5, 5],
                                borderWidth: 2,
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                label: 'T√©cnica (T)',
                                data: simData.T,
                                borderColor: 'rgba(13, 110, 253, 0.6)', // Blue
                                borderDash: [5, 5],
                                borderWidth: 2,
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                label: 'Mentalidad (M)',
                                data: simData.M,
                                borderColor: 'rgba(255, 193, 7, 0.6)', // Yellow
                                borderDash: [5, 5],
                                borderWidth: 2,
                                fill: false,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                title: {
                                    display: true,
                                    text: 'Edad del Jugador'
                                },
                                min: 0,
                                max: 50
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Nivel (0-100)'
                                },
                                min: 0,
                                max: 100
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Proyecci√≥n de Rendimiento'
                            }
                        }
                    }
                });
            }
            
        } catch (error) {
            console.error('Error:', error);
            alert('Hubo un error al realizar la predicci√≥n.');
        }
    });
</script>

</body>
</html>
